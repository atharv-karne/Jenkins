pipeline {
    agent none

    stages {
        stage('Starting execution') {
            steps {
                echo 'Pipeline has been started successfully!'
            }
        }

        stage('Terraform apply') {
            agent any
            steps {
                dir('/04_IAM_S3') {
                    script {
                        try {
                            sh 'terraform init'
                            sh 'terraform apply -auto-approve'
                        } catch (Exception e) {
                            echo "Error during Terraform apply: ${e}"
                            currentBuild.result = 'FAILURE'
                        }
                    }
                }
            }
        }
    }
}
